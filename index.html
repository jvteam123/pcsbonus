<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCS Advanced Bonus Calculator</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <script src="https://unpkg.com/shapefile@0.6.6/dist/shapefile.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

    <script>
        const firebaseConfig = {
        apiKey: "AIzaSyDkeA5QzcTkpgNiSDJ2S4rwHD8g8eHbj5M",
        authDomain: "pcsbonus-54607.firebaseapp.com",
        projectId: "pcsbonus-54607",
        storageBucket: "pcsbonus-54607.appspot.com",
        messagingSenderId: "406315081815",
        appId: "1:406315081815:web:0cfa3915ec314f1f2f8312",
        measurementId: "G-C2J9ESZFTH"

        };
        
        // Initialize Firebase. This makes the global 'firebase' object available
        // before script.js tries to access it.
        firebase.initializeApp(firebaseConfig); 
    </script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/relativeTime.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ua-parser-js@0.7.32/src/ua-parser.min.js"></script>

    <link rel="stylesheet" href="style.css?v=1.3">
    <script src="script.js?v=1.3"></script> 
    
    <script>
        // Custom Tailwind...
        tailwind.config = {
            darkMode: 'class', // Enable dark mode by default
            theme: {
                extend: {
                    colors: {
                        'brand': {
                            900: '#1F1D2B', 800: '#252836', 700: '#393C49', 600: '#4F5B6A',
                            400: '#ABBBC2', 300: '#FFFFFF'
                        },
                        'accent': '#6C5ECF', 'accent-hover': '#584BAF',
                        'status-red': '#FF7CA3', 'status-orange': '#FFB572', 'status-green': '#50D1AA',
                    },
                    boxShadow: {
                        'custom': '0 4px 15px rgba(0,0,0,0.2)',
                    },
                }
            }
        }
    </script>
    </head>
<body class="dark-theme bg-brand-900 text-brand-300">
    <div id="app" class="min-h-screen flex flex-col">
        <header class="bg-brand-800 shadow-md p-4 flex items-center justify-between sticky top-0 z-40">
            <h1 class="text-xl font-semibold text-accent flex items-center">
                PCS Advanced Bonus Calculator
                <span id="version-display" class="text-xs ml-2 text-brand-400 font-normal">v1.3</span>
            </h1>
            <div class="flex items-center space-x-4">
                <button id="auth-status-btn" class="text-brand-300 hover:text-accent flex items-center space-x-2 p-2 rounded-lg transition duration-150 ease-in-out" aria-label="Sign In/Out">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
                    <span id="auth-text" class="text-sm font-medium">Sign In</span>
                </button>
                <div class="relative">
                    <button id="settings-menu-btn" class="text-brand-300 hover:text-accent p-2 rounded-full transition duration-150 ease-in-out" aria-label="Settings and Options">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09A1.65 1.65 0 0 0 15 4.6a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                    </button>
                    <div id="settings-menu-dropdown" class="absolute right-0 mt-2 w-56 bg-brand-800 rounded-lg shadow-xl py-2 z-50 hidden border border-brand-700">
                        <a href="#" id="toggle-theme-btn" class="flex items-center px-4 py-2 text-sm text-brand-300 hover:bg-brand-700">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3 w-5 h-5"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                            <span id="theme-text">Light Mode</span>
                        </a>
                        <a href="#" id="open-settings-modal-btn" class="flex items-center px-4 py-2 text-sm text-brand-300 hover:bg-brand-700">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3 w-5 h-5"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.39a2 2 0 0 0 .73 2.73l.15.15a2 2 0 0 1 0 2.73l-.15.15a2 2 0 0 0-.73 2.73l.22.39a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.15a2 2 0 0 1 0-2.73l.15-.15a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                            <span>Settings</span>
                        </a>
                        <a href="#" id="open-changelog-modal-btn" class="flex items-center px-4 py-2 text-sm text-brand-300 hover:bg-brand-700">
                             <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3 w-5 h-5"><path d="M12 20h.01"/><path d="M13 14h.01"/><path d="M11 10h.01"/><path d="M12 2a10 10 0 0 0-9.09 5.86c0 1.25.5 2.45 1.38 3.33l6.57 6.57a2 2 0 0 0 2.83 0l6.57-6.57a4.99 4.99 0 0 0 1.38-3.33A10 10 0 0 0 12 2z"/></svg>
                            <span>Changelog</span>
                        </a>
                        <div id="admin-menu-item" class="border-t border-brand-700 mt-2 pt-2 hidden">
                             <a href="#" id="open-admin-modal-btn" class="flex items-center px-4 py-2 text-sm text-status-red hover:bg-brand-700">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3 w-5 h-5"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                                <span>Admin Portal</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <main class="flex-grow p-4 md:p-8">
            <div id="loading-overlay" class="fixed inset-0 bg-brand-900 bg-opacity-80 z-50 flex items-center justify-center hidden">
                <div class="flex flex-col items-center">
                    <div class="loader ease-linear rounded-full border-4 border-t-4 border-brand-700 h-12 w-12 mb-4"></div>
                    <p class="text-brand-300 text-lg">Loading...</p>
                </div>
            </div>

            <div id="notification-container" class="fixed top-16 left-1/2 transform -translate-x-1/2 z-50 w-full max-w-sm">
                </div>

            <section id="guided-setup-section" class="bg-brand-800 p-6 rounded-xl shadow-custom mb-8 border border-brand-700 hidden">
                <h2 class="text-2xl font-bold text-accent mb-4 flex items-center">
                     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2 w-6 h-6"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
                    Guided Setup: <span id="setup-step-title" class="ml-2 font-normal text-brand-300"></span>
                </h2>
                <div id="setup-progress" class="w-full bg-brand-700 rounded-full h-2.5 mb-4">
                    <div id="setup-progress-bar" class="bg-accent h-2.5 rounded-full transition-all duration-500" style="width: 25%"></div>
                </div>
                <div id="setup-content" class="text-brand-400">
                    </div>
                <div class="flex justify-between mt-6">
                    <button id="setup-prev-btn" class="px-4 py-2 bg-brand-700 text-brand-300 rounded-lg hover:bg-brand-600 transition duration-150 ease-in-out disabled:opacity-50" disabled>Previous</button>
                    <div>
                        <button id="setup-next-btn" class="px-4 py-2 bg-accent text-white rounded-lg hover:bg-accent-hover transition duration-150 ease-in-out">Next</button>
                        <button id="setup-start-tour-btn" class="px-4 py-2 bg-status-green text-white rounded-lg hover:opacity-80 transition duration-150 ease-in-out ml-2 hidden">Start Tour</button>
                        <button id="setup-finish-btn" class="px-4 py-2 bg-status-green text-white rounded-lg hover:opacity-80 transition duration-150 ease-in-out ml-2 hidden">Finish Setup</button>
                    </div>
                </div>
            </section>

            <section id="main-app-section" class="space-y-8">
                <div class="bg-brand-800 p-6 rounded-xl shadow-custom border border-brand-700">
                    <div id="drop-zone" class="border-2 border-dashed border-brand-700 rounded-lg p-10 text-center cursor-pointer transition duration-300 hover:bg-brand-700/50">
                        <p class="text-xl font-semibold text-brand-300">Drag & Drop Your Project File (.json) Here</p>
                        <p class="text-brand-400 mt-2">or click to manually select a file</p>
                        <input type="file" id="file-input" accept=".json" class="hidden">
                    </div>

                    <div id="control-panel" class="mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <button id="load-example-btn" class="p-3 bg-brand-700 text-brand-300 rounded-lg hover:bg-brand-600 transition duration-150 ease-in-out">Load Example Project</button>
                        <button id="clear-all-btn" class="p-3 bg-status-red text-white rounded-lg hover:opacity-90 transition duration-150 ease-in-out">Clear All Data</button>
                        <button id="download-btn" class="p-3 bg-accent text-white rounded-lg hover:bg-accent-hover transition duration-150 ease-in-out">Download Project (.json)</button>
                        <button id="update-online-btn" class="p-3 bg-status-green text-white rounded-lg hover:opacity-90 transition duration-150 ease-in-out hidden">Save To Cloud</button>
                    </div>
                </div>

                <div id="summary-section" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 hidden">
                    <div id="summary-total-bonus" class="bg-brand-800 p-4 rounded-xl shadow-custom border border-brand-700 text-center">
                        <p class="text-brand-400 text-sm">Total Bonus Payout</p>
                        <p id="total-bonus-value" class="text-3xl font-bold text-status-green mt-1">$0.00</p>
                    </div>
                    <div id="summary-team-count" class="bg-brand-800 p-4 rounded-xl shadow-custom border border-brand-700 text-center">
                        <p class="text-brand-400 text-sm">Total Techs Processed</p>
                        <p id="total-techs-value" class="text-3xl font-bold text-accent mt-1">0</p>
                    </div>
                    <div id="summary-average-payout" class="bg-brand-800 p-4 rounded-xl shadow-custom border border-brand-700 text-center">
                        <p class="text-brand-400 text-sm">Average Payout / Tech</p>
                        <p id="average-payout-value" class="text-3xl font-bold text-brand-300 mt-1">$0.00</p>
                    </div>
                    <div id="summary-last-update" class="bg-brand-800 p-4 rounded-xl shadow-custom border border-brand-700 text-center">
                        <p class="text-brand-400 text-sm">Last Update Time</p>
                        <p id="last-update-value" class="text-3xl font-bold text-brand-300 mt-1">N/A</p>
                    </div>
                </div>

                <div id="filter-search-section" class="bg-brand-800 p-4 rounded-xl shadow-custom border border-brand-700 flex flex-wrap gap-4 items-center hidden">
                    <input type="text" id="search-input" placeholder="Search by Tech ID, Name, or Team" class="flex-grow min-w-[200px] p-2 bg-brand-900 border border-brand-700 rounded-lg text-brand-300 focus:ring-accent focus:border-accent">
                    <select id="team-filter" class="p-2 bg-brand-900 border border-brand-700 rounded-lg text-brand-300 focus:ring-accent focus:border-accent">
                        <option value="all">Filter by Team (All)</option>
                        </select>
                </div>

                <div id="data-table-container" class="bg-brand-800 p-6 rounded-xl shadow-custom border border-brand-700 overflow-x-auto hidden">
                    <table id="tech-data-table" class="min-w-full divide-y divide-brand-700">
                        <thead class="bg-brand-700/50">
                            <tr>
                                </tr>
                        </thead>
                        <tbody id="table-body" class="divide-y divide-brand-700">
                            </tbody>
                    </table>
                    <div id="no-results-message" class="text-center p-4 text-brand-400 hidden">No results found for your search/filter criteria.</div>
                </div>

                <div id="team-stats-section" class="bg-brand-800 p-6 rounded-xl shadow-custom border border-brand-700 hidden">
                    <h2 class="text-2xl font-bold text-accent mb-4">Team Workload Distribution</h2>
                    <div id="workload-chart-container" class="h-96">
                        <canvas id="workload-chart"></canvas>
                    </div>
                    <div id="team-workload-list" class="mt-6 space-y-3">
                        </div>
                </div>
            </section>
        </main>

        <div id="settings-modal" class="fixed inset-0 bg-brand-900 bg-opacity-90 z-50 flex items-center justify-center hidden">
            <div class="bg-brand-800 rounded-xl shadow-2xl p-6 w-full max-w-lg border border-brand-700">
                <div class="flex justify-between items-center border-b border-brand-700 pb-3 mb-4">
                    <h3 class="text-xl font-bold text-accent">Application Settings</h3>
                    <button class="modal-close-btn text-brand-400 hover:text-brand-300">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                    </button>
                </div>

                <div class="space-y-4">
                    <div>
                        <label for="bonus-tiers" class="block text-brand-300 font-medium mb-2">Bonus Tiers (JSON Format)</label>
                        <textarea id="bonus-tiers" rows="6" class="w-full p-3 bg-brand-900 border border-brand-700 rounded-lg text-brand-300 focus:ring-accent focus:border-accent"></textarea>
                        <p class="text-sm text-brand-400 mt-1">Define bonus tiers: `[{"min_jobs": 15, "payout": 50}, ...]`</p>
                    </div>

                    <div>
                        <label for="calculation-settings" class="block text-brand-300 font-medium mb-2">Calculation Settings (JSON Format)</label>
                        <textarea id="calculation-settings" rows="6" class="w-full p-3 bg-brand-900 border border-brand-700 rounded-lg text-brand-300 focus:ring-accent focus:border-accent"></textarea>
                        <p class="text-sm text-brand-400 mt-1">Define formulas and rules: `{"base_gsd": 1.5, "max_jobs": 40, ...}`</p>
                    </div>

                    <div>
                        <label for="counting-settings" class="block text-brand-300 font-medium mb-2">Job Counting Settings (JSON Format)</label>
                        <textarea id="counting-settings" rows="6" class="w-full p-3 bg-brand-900 border border-brand-700 rounded-lg text-brand-300 focus:ring-accent focus:border-accent"></textarea>
                        <p class="text-sm text-brand-400 mt-1">Define which job types count: `{"install_full": 1.0, "install_partial": 0.5, ...}`</p>
                    </div>

                    <div class="flex justify-end pt-2">
                        <button id="save-settings-btn" class="px-6 py-2 bg-accent text-white rounded-lg hover:bg-accent-hover transition duration-150 ease-in-out">Save Settings</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="changelog-modal" class="fixed inset-0 bg-brand-900 bg-opacity-90 z-50 flex items-center justify-center hidden">
            <div class="bg-brand-800 rounded-xl shadow-2xl p-6 w-full max-w-lg border border-brand-700 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center border-b border-brand-700 pb-3 mb-4 sticky top-0 bg-brand-800 z-10">
                    <h3 class="text-xl font-bold text-accent">Changelog (v1.3)</h3>
                    <button class="modal-close-btn text-brand-400 hover:text-brand-300">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                    </button>
                </div>
                <div id="changelog-content" class="text-brand-300 space-y-4">
                    <p class="text-brand-400">Loading changelog...</p>
                </div>
            </div>
        </div>

        <div id="admin-modal" class="fixed inset-0 bg-brand-900 bg-opacity-90 z-50 flex items-center justify-center hidden">
            <div class="bg-brand-800 rounded-xl shadow-2xl p-6 w-full max-w-4xl border border-brand-700 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center border-b border-brand-700 pb-3 mb-4 sticky top-0 bg-brand-800 z-10">
                    <h3 class="text-xl font-bold text-status-red">Admin Portal</h3>
                    <button class="modal-close-btn text-brand-400 hover:text-brand-300">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                    </button>
                </div>

                <div class="space-y-6">
                    <div class="bg-brand-700/30 p-4 rounded-lg">
                        <h4 class="text-lg font-semibold text-brand-300 mb-3">Cloud Project Management</h4>
                        <div class="flex items-center space-x-4 mb-4">
                            <button id="load-admin-projects-btn" class="px-4 py-2 bg-accent text-white rounded-lg hover:bg-accent-hover transition duration-150 ease-in-out">Refresh Projects</button>
                            <button id="download-all-projects-btn" class="px-4 py-2 bg-status-green text-white rounded-lg hover:opacity-90 transition duration-150 ease-in-out">Download All Projects</button>
                        </div>
                        <div id="admin-project-list" class="space-y-2 max-h-48 overflow-y-auto">
                            <p class="text-brand-400">No projects loaded.</p>
                        </div>
                    </div>

                    <div class="bg-brand-700/30 p-4 rounded-lg">
                        <h4 class="text-lg font-semibold text-brand-300 mb-3">Upload Tech Stats</h4>
                         <div id="admin-drop-zone" class="border-2 border-dashed border-brand-700 rounded-lg p-6 text-center cursor-pointer transition duration-300 hover:bg-brand-700/50">
                            <p class="text-brand-300">Drag & Drop Tech Stats File (.json) Here</p>
                            <p class="text-brand-400 text-sm mt-1">or click to manually select a file</p>
                            <input type="file" id="admin-file-input" accept=".json" class="hidden">
                        </div>
                        <div id="tech-stats-summary" class="mt-4 text-brand-400 hidden">
                             <p>File loaded: <span id="stats-file-name" class="font-semibold text-brand-300"></span></p>
                             <p>Contains <span id="stats-tech-count" class="font-semibold text-brand-300"></span> technician records.</p>
                        </div>
                        <div class="flex justify-end mt-4">
                            <button id="upload-tech-stats-btn" class="px-6 py-2 bg-accent text-white rounded-lg hover:bg-accent-hover transition duration-150 ease-in-out disabled:opacity-50" disabled>Upload Stats to Cloud</button>
                        </div>
                    </div>

                    <div class="bg-brand-700/30 p-4 rounded-lg">
                        <h4 class="text-lg font-semibold text-brand-300 mb-3">Update Global Bonus Configuration</h4>
                        <div class="flex space-x-4">
                            <button id="update-global-config-btn" class="px-4 py-2 bg-status-green text-white rounded-lg hover:opacity-90 transition duration-150 ease-in-out">Update From Local Settings</button>
                            <button id="download-global-config-btn" class="px-4 py-2 bg-brand-600 text-brand-300 rounded-lg hover:bg-brand-400 transition duration-150 ease-in-out">Download Global Config</button>
                        </div>
                        <p class="text-sm text-brand-400 mt-2">Pushes your current local bonus tiers, calculation, and counting settings to the cloud.</p>
                    </div>
                </div>
            </div>
        </div>


        <footer class="bg-brand-800 p-4 text-center text-brand-400 text-sm border-t border-brand-700 mt-8">
            <p>&copy; 2023 PCS Advanced Bonus Calculator. All rights reserved.</p>
        </footer>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Function to handle dropdowns
            const setupDropdown = (buttonId, dropdownId) => {
                const button = document.getElementById(buttonId);
                const dropdown = document.getElementById(dropdownId);
                if (!button || !dropdown) return;

                button.addEventListener('click', () => {
                    dropdown.classList.toggle('hidden');
                });

                document.addEventListener('click', (e) => {
                    if (!button.contains(e.target) && !dropdown.contains(e.target)) {
                        dropdown.classList.add('hidden');
                    }
                });
            };

            // Setup the settings menu dropdown
            setupDropdown('settings-menu-btn', 'settings-menu-dropdown');

            // Setup modal close buttons
            document.querySelectorAll('.modal-close-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const modal = button.closest('.fixed');
                    if (modal) modal.classList.add('hidden');
                });
            });
        });
    </script>
    <div id="chatbot-container" class="fixed bottom-5 right-5 z-50">
    <div id="chatbot-bubble" class="w-16 h-16 bg-accent rounded-full flex items-center justify-center cursor-pointer shadow-lg">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="white" viewBox="0 0 16 16">
            <path d="M8 15c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7c0 1.76.743 3.37 1.97 4.6-.097 1.016-.417 2.13-.771 2.966-.079.186.074.394.273.362 2.256-.37 3.597-.938 4.18-1.234A9.06 9.06 0 0 0 8 15z"/>
        </svg>
    </div>
    <div id="chatbot-window" class="fixed bottom-24 right-5 w-80 h-[400px] bg-brand-800 rounded-xl shadow-2xl flex flex-col hidden border border-brand-700">
        <div class="bg-accent p-4 rounded-t-xl flex justify-between items-center">
            <h5 class="text-white font-semibold">PCS Chatbot</h5>
            <button id="close-chatbot-btn" class="text-white hover:text-brand-300">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
        </div>
        <div id="chatbot-messages" class="flex-grow p-4 overflow-y-auto space-y-3">
            <div class="chatbot-message bot">
                <div class="message-bubble bg-brand-700 text-brand-300 p-3 rounded-lg max-w-[85%] inline-block">
                    Hello! I can help you with questions about the Bonus Calculator's rules and functionality.
                </div>
                <div class="suggestions-container">
                    <button class="suggestion-btn text-xs px-2 py-1 bg-brand-900 border border-brand-700 text-brand-400 rounded-full hover:bg-brand-700/50">How is the bonus calculated?</button>
                    <button class="suggestion-btn text-xs px-2 py-1 bg-brand-900 border border-brand-700 text-brand-400 rounded-full hover:bg-brand-700/50">What is GSD?</button>
                </div>
            </div>
        </div>
        <div class="p-4 border-t border-brand-700">
            <div class="flex items-center">
                <input type="text" id="chatbot-input" placeholder="Ask a question..." class="flex-grow p-2 bg-brand-900 border border-brand-700 rounded-l-lg text-brand-300 focus:outline-none">
                <button id="chatbot-send-btn" class="bg-accent text-white p-2 rounded-r-lg hover:bg-accent-hover transition duration-150 ease-in-out">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
                </button>
            </div>
        </div>
    </div>
</div>
</body>
</html>
